<!DOCTYPE html>
<html lang="en">
<head>
  <body class="chatbot-page">
  <meta charset="UTF-8">
  <title>English Level ChatBot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Fredoka', sans-serif;
      background: linear-gradient(135deg, #2d0b5c, #43158a, #602fa3);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes scale-in {
      from { transform: scale(0.92); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }
    .animate-scale-in {
      animation: scale-in 0.6s cubic-bezier(.35,1.5,.59,1) both;
    }
    @keyframes scale-out {
      from { transform: scale(1); opacity: 1; }
      to   { transform: scale(0.92); opacity: 0; }
    }
    .animate-scale-out {
      animation: scale-out 0.4s cubic-bezier(.45,1.5,.59,1) both;
    }
    .chatbot-page .chat-container {
      margin-left: 80px; /* —à–∏—Ä–∏–Ω–∞ sidebar, –µ—Å–ª–∏ sidebar —à–∏—Ä–µ/—É–∂–µ ‚Äî –ø–æ–º–µ–Ω—è–π */
    }
</style>
  </style>
</head>
<div class="flex h-screen overflow-hidden text-white text-[20px]">
  {% include 'sidebar.html' %}
 

<div class="flex-1 flex flex-col h-full relative chat-container">
  {% if greeting %}
        <!-- Blur —Ñ–æ–Ω -->
    <div class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ -->
    <div class="fixed inset-0 flex items-center justify-center z-50 animate-scale-in">
      <div class="max-w-2xl w-full bg-gradient-to-b from-white via-purple-100 to-purple-200 p-12 rounded-[2.5rem] shadow-2xl text-center relative">
        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è -->
        <button onclick="history.back()" class="absolute top-6 right-6 z-20 p-2 rounded-full bg-white/70 hover:bg-purple-200 transition duration-200 shadow-md">
          <img src="{{ url_for('static', filename='close.png') }}" alt="–ó–∞–∫—Ä—ã—Ç—å" class="w-8 h-8">
          
        </button>
        <div class="w-44 h-44 mx-auto mb-7 rounded-full bg-purple-200 flex items-center justify-center ring-4 ring-purple-300 shadow-lg">
          <img src="{{ url_for('static', filename='robot_11260797.gif') }}" alt="Chatbot"
              class="w-40 h-40 object-contain rounded-full" />
        </div>
        <h1 class="text-4xl font-extrabold text-purple-900 mb-2">–ü—Ä–∏–≤–µ—Ç! <span class="ml-1"></span></h1>
        <p class="text-lg text-purple-800 mb-8 leading-relaxed">
          –Ø –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ.<br>
          –ó–∞–¥–∞—é –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–æ–≤–µ—Ä—è—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –∏ –ø–æ–ø—Ä–æ—à—É –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—É —Ñ—Ä–∞–∑. –ì–æ—Ç–æ–≤(-–∞)?
        </p>
        <form method="post">
          <input type="hidden" name="start" value="yes">
          <button class="w-full bg-gradient-to-r from-pink-400 via-fuchsia-500 to-purple-600 text-white py-4 px-6 rounded-full font-bold text-xl shadow-md hover:scale-105 transition">
            üöÄ –ù–∞—á–∞—Ç—å
          </button>
        </form>
      </div>
    </div>
    {% endif %}

    {% if not greeting %}

  <!-- Fullscreen Chat -->
  <div class="flex-1 flex flex-col px-8 py-10 overflow-hidden">
    <div class="absolute inset-0 z-0 opacity-60">
      <img src="{{ url_for('static', filename='sunset.jpg') }}"
           alt="Background"
           class="w-full h-full object-cover rounded-none">
    </div>
  
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö -->
    <div class="flex-1 flex flex-col h-full relative z-10">
      <h1 class="text-3xl font-bold mb-6 text-white">üó®Ô∏è Practice your English with AI</h1>
  
      <div id="chat-container" class="flex-1 overflow-y-auto space-y-4 px-4 py-6 bg-white bg-opacity-10 rounded-3xl shadow-inner">
        {% for m in messages %}
          <div class="flex {% if m.sender == 'user' %}justify-end{% else %}justify-start{% endif %}">
            <div class="max-w-2xl px-6 py-4 text-lg leading-relaxed rounded-3xl shadow-md
              {% if m.sender == 'user' %}bg-indigo-500 text-white{% else %}bg-white bg-opacity-80 text-black{% endif %}">
              <strong class="font-bold">{{ m.sender.capitalize() }}:</strong> {{ m.text|safe }}

            </div>

          </div>
        {% endfor %}
      </div>
  
      {% if result %}
      <div class="mt-6 bg-green-100 text-green-900 p-4 rounded-xl text-center shadow">
        {{ result|safe }}
      </div>
      {% endif %}
  
      <form id="chat-form" class="mt-6 flex gap-4" autocomplete="off">
        <textarea name="message" id="chat-input" rows="2" class="flex-1 p-3 rounded-xl resize-none text-black" placeholder="Type your reply..." required></textarea>
        <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-xl font-semibold">Send</button>
      </form>

  
      <div class="mt-4 flex justify-between items-center">
        <a href="/" class="text-indigo-200 underline hover:text-white">‚¨Ö Back to Generator</a>
        <form method="post" action="/chat/reset">
          <button type="submit" class="bg-gradient-to-r from-yellow-300 via-yellow-400 to-purple-500 text-white px-4 py-2 rounded-xl shadow hover:opacity-90 font-semibold transition">
            –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
          </button>
          
        </form>
      </div>
    </div>
    {% endif %}
  </div>
  <script>
    window.onload = function() {
      const chat = document.getElementById("chat-container");
      if (chat) {
        chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
      }
    };
  </script>
  <script>
document.getElementById("chat-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const textarea = document.getElementById("chat-input");
    const msg = textarea.value.trim();
    if (!msg) return;
    textarea.value = "";

    let chatBox = document.getElementById("chat-container");

    // –ü–æ–∫–∞–∂–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ä–∞–∑—É
    chatBox.innerHTML += `<div class="flex justify-end">
      <div class="max-w-2xl px-6 py-4 text-lg leading-relaxed rounded-3xl shadow-md bg-indigo-500 text-white">
        <strong class="font-bold">User:</strong> ${msg}
      </div>
    </div>`;
    chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });

    // –ü–æ–∫–∞–∂–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (–º–æ–∂–µ—à—å —Å—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤–µ–µ)
    chatBox.innerHTML += `<div id="bot-typing" class="flex justify-start">
      <div class="max-w-2xl px-6 py-4 text-lg leading-relaxed rounded-3xl shadow-md bg-white bg-opacity-80 text-black italic">Bot is typing...</div>
    </div>`;
    chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });

    // –û—Ç–ø—Ä–∞–≤—å –Ω–∞ backend
    const resp = await fetch("/chat/api/send", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({message: msg})
    });
    const data = await resp.json();

    // –£–±–µ—Ä–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    document.getElementById("bot-typing")?.remove();

    // –ü–æ–∫–∞–∂–∏ –æ—Ç–≤–µ—Ç –±–æ—Ç–∞
    if (data.messages && data.messages.length > 0) {
      const botMsg = data.messages[data.messages.length - 1];
      chatBox.innerHTML += `<div class="flex justify-start">
        <div class="max-w-2xl px-6 py-4 text-lg leading-relaxed rounded-3xl shadow-md bg-white bg-opacity-80 text-black">
          <strong class="font-bold">Bot:</strong> ${botMsg.text}
        </div>
      </div>`;
      chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
    }

    // –ï—Å–ª–∏ –µ—Å—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø–æ–∫–∞–∂–∏ –Ω–∏–∂–µ —á–∞—Ç–∞
    if (data.result) {
      let resultBlock = document.querySelector("#chat-result");
      if (!resultBlock) {
        resultBlock = document.createElement("div");
        resultBlock.id = "chat-result";
        document.querySelector(".flex-1.flex.flex-col.h-full.relative.z-10").appendChild(resultBlock);
      }
      resultBlock.innerHTML = `<div class="mt-6 bg-green-100 text-green-900 p-4 rounded-xl text-center shadow">${data.result}</div>`;
    }
});
</script>

</body>
</html>




